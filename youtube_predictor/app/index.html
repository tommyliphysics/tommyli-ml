<!DOCTYPE html>
<html >
<!--Based on https://codepen.io/frytyler/pen/EGdtg-->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="static/css/style.css">
    <title>Youtube popularity predictor</title>
</head>

<body>
    <div class="flex-container">
        <div class="flex-container" style="width: 50%; height: 15%; margin-bottom: 20px; text-align:center;">
            <h1>Youtube popularity predictor</h1>
Enter your video details below to see the predictions. The models were trained on a collection of 31662 videos published between January 2018 and April 2024 obtained through an API search with the keywords: 'engineering', 'technology', 'computers', 'maths', 'physics', 'biology', 'chemistry', 'statistics', 'medicine.' The app is expected to perform best when your video is related to one of these topics.
        </div>

        <div class="flex-container" style= "margin-bottom:20vh;">
            <div class="flex-container" style="height: 40%; margin-bottom: 15px;">
                <textarea class="input" id = "channelTitle" placeholder = "Enter channel name" cols = 100 rows = 2 ></textarea>
                <textarea class="input" id = "videoTitle" placeholder = "Enter video title" cols= 100 rows=2></textarea>
                <textarea class="input" id = "videoDescription" placeholder = "Enter video description" cols= 100 rows=8></textarea>
                <div style="display:flex; flex-direction: row; width:100%; align-items:center; margin-left:45vw; margin-right: 45vw; font-color: #efe; font-size:18pt; font-weight:bold; text-align: center;">
                    Video category: <textarea class="input" id = "videoCategory" cols=3 rows=1 style="margin-left:5px;"></textarea>
                </div>
            </div>
            <div style="width: 50%; height: 10%; margin-left: auto; margin-right: auto; margin-bottom: 15px;">
You can find a list of video categories <a href="https://mixedanalytics.com/blog/list-of-youtube-video-category-ids/"> here </a>. Available video categories: 1,  2, 10, 15, 17, 19, 20, 22, 23, 24, 25, 26, 27, 28, 29, 30.
            </div>
            <div class="flex-container" style="width: 20%; height:20px; margin-bottom: 20px;">
                <button class="button" id = "predictButton" onclick="getVideoDetails()">Predict</button></div>
            </div>
        </div>

        <div id="predictionsDiv" class="flex-container" style = "width:100%; margin-top: 20px; margin-bottom: 20px;"></div>
    <script>
        function getVideoDetails() {
            var predictButton = document.getElementById("predictButton")
            predictButton.innerHTML = "Getting predictions...";
            var predictionsDiv = document.getElementById("predictionsDiv");
            
            var inputVideoCategory = document.getElementById('videoCategory').value;
            var inputChannelTitle = document.getElementById('channelTitle').value;
            var inputVideoTitle = document.getElementById('videoTitle').value;
            var inputVideoDescription = document.getElementById('videoDescription').value;

            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://192.168.1.102:5003/predict?video_category=' + inputVideoCategory + '&channel_title=' + inputChannelTitle + '&video_title=' + inputVideoTitle + '&video_description=' + inputVideoDescription, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    predictButton.innerHTML = "Predict";
                    if (xhr.status === 200) {
                        var predictionsRecv = JSON.parse(xhr.responseText);
                        displayPredictions(predictionsRecv);
                    } else {
                        console.error('Request failed:', xhr.status);
                        predictionsDiv.textContent = `Request failed: ${xhr.status}`;
                    }
                }
            };
            xhr.send();
        }

        function displayPredictions(predictions) {
            var predictionsDiv = document.getElementById('predictionsDiv');
            var inputVideoCategory = document.getElementById('videoCategory').value;
            var inputChannelTitle = document.getElementById('channelTitle').value;
            var inputVideoTitle = document.getElementById('videoTitle').value;
            var inputVideoDescription = document.getElementById('videoDescription').value;

            predictionsDiv.innerHTML = `
            <div class = "scroll-box" style = "width: 50%; height: 7%;">
                <b>Channel name: </b> ${inputChannelTitle}
            </div>
            <div class = "scroll-box" style = "width: 50%; height: 7%;">
                <b>Video title: </b> ${inputVideoTitle}
            </div>
            <div class = "scroll-box" style = "width: 50%; height: 15%; margin-bottom: 25px;">
                <b>Video description: </b> ${inputVideoDescription}
            </div>
            <div class = "scroll-box" style = "width: 50%; height: 7%;">
                <b>Video category: </b> ${inputVideoCategory}
            </div>

        
            <div class = "prediction-text" style = "width: 50%; margin-bottom:7vh;">
                <table style="width: 100%; margin: 5px auto; text-align:left;">
                    <tr><th>Multinomial naive Bayes:</th><td>${predictions.mnB_class} (${predictions.mnB_proba})</td></tr>
                    <tr><th>Support vector machine:</th><td>${predictions.svm_class} (${predictions.svm_proba})</td></tr>
                    <tr><th>Logistic regression:</th><td>${predictions.logreg_class} (${predictions.logreg_proba})</td></tr>
                    <tr><th>Perceptron algorithm:</th><td>${predictions.perceptron_class} (${predictions.perceptron_proba})</td></tr>
                    <tr><th>Stacking classifier (4 models) with logistic regression:</td><td>${predictions.stacking_logreg_class} (${predictions.stacking_logreg_proba})</td></tr>
                </table>
            </div>
                `;
            predictionsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } 
    </script>

        <div class="flex-container">
            <button class="collapsible" onclick="showAbout('about')" style="width:40%; margin-bottom: 10vh;">Learn about the models</button>
            <div id="about" class = "model-reports" style = "width: 80%; margin-bottom: 10vh;">
                <div style="padding:36px;">
<b>About the models</b>
<br><br>
The machine learning models operate purely on natural language processing to convert the text of the channel name, video title and description into numerical data that can be analysed using statistical methods. The preprocessing consisted of first byte-pair encoding the text sample, which allows it to be broken up into small elements, referred to as <i>tokens</i>, that can be numerically indexed. A token can be a whole word, a part of a word, a symbol, number or punctuation. The frequency distribution of the tokens is then calculated to produce a represent the text as a single point in a high-dimensional space, where each dimension corresponds to an individual token. The co-ordinate vector used to represent a text is used as the input data for a number of binary classification methods, where inference involves predicting whether the video belongs to one of two classes, corresponding to those with over or under 100k views:
<ol>
<li> <b>Multinomial naive Bayes:</b> Bayes' theorem is used to convert the probability of data that belongs to a certain class possessing a certain property into the probability that data possessing that property belongs to that class. A naive Bayesian model further assumes the features are independent.</li>
<li><b>Support vector machine:</b> this method relies on the spatial distribution of the vectorised representation of a text in an abstract vector space: it roughly finds a boundary between the classes and then fits a hyperplane to separate them. The probability of a text belonging to a certain class relates to its distance from the boundary hyperplane and which side of the hyperplane it is on.</li>
<li><b>Logistic regression:</b> the probability of a video belonging to a certain class is modeled by a sigmoid function, with the argument being a linear combination of the co-ordinates of the vectorised form of the text data. The weights of the linear combination are fitted using maximum likelihood estimation, where the binary cross-entropy is minimised.</li>
<li><b>Perceptron:</b> like logistic regression, this model relies on calculating a linear combination of the co-ordinates of the vectorised text, and the prediction is decided based on whether the linear combination exceeds a certain threshold (the bias). The weights and biases are minimised using the perceptron algorithm.</li>
<li><b>Stacking classifiers:</b> these combine several models by using their predictions as input to a final model, called the meta-classifier. I chose logistic regression as a metaclassifier to combine the four models above.</li>
</ol>

The models were trained on a set of 31662 videos returned from a YouTube API search with the keyword 'science,' and then evaluated on a separate test set consisting of 6333 videos.
<br>
Here are the classification reports (the positive class corresponds to videos with over 100k views):
<br><br>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>accuracy</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>TP</th>
      <th>FN</th>
      <th>FP</th>
      <th>TN</th>
    </tr>
    <tr>
      <th>model</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Multinomial naive Bayes</th>
      <td>0.823622</td>
      <td>0.818307</td>
      <td>0.711315</td>
      <td>0.761070</td>
      <td>1779</td>
      <td>722</td>
      <td>395</td>
      <td>3437</td>
    </tr>
    <tr>
      <th>svm_log(TF)-IDF_calibrated</th>
      <td>0.832939</td>
      <td>0.795092</td>
      <td>0.777289</td>
      <td>0.786090</td>
      <td>1944</td>
      <td>557</td>
      <td>501</td>
      <td>3331</td>
    </tr>
    <tr>
      <th>Logistic regression</th>
      <td>0.828359</td>
      <td>0.784164</td>
      <td>0.780088</td>
      <td>0.782121</td>
      <td>1951</td>
      <td>550</td>
      <td>537</td>
      <td>3295</td>
    </tr>
    <tr>
      <th>Perceptron</th>
      <td>0.830570</td>
      <td>0.791429</td>
      <td>0.775290</td>
      <td>0.783276</td>
      <td>1939</td>
      <td>562</td>
      <td>511</td>
      <td>3321</td>
    </tr>
    <tr>
      <th>Stacking</th>
      <td>0.834833</td>
      <td>0.805287</td>
      <td>0.767293</td>
      <td>0.785831</td>
      <td>1919</td>
      <td>582</td>
      <td>464</td>
      <td>3368</td>
    </tr>
  </tbody>
</table>
<br>
<br>
And here are the ROC and precision-recall curves:
        <br><br>
<img style="width: 70%; display:block; margin:auto;" src="static/roc_pr.jpg" alt = "ROC and precision-recall curves">
                </div>
            </div>
        </div>

        <script>
            window.onload = function() {
                var element = document.getElementById('prediction');
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };
        </script>
        <script>
            function showAbout() {
                var hiddenTextElement = document.getElementById('about');
                if(hiddenTextElement.style.display == "none") {
                    hiddenTextElement.style.display = "block";
                    hiddenTextElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else{
                    hiddenTextElement.style.display = "none";
                }
            }
        </script>

    </div>
</body>
</html>
